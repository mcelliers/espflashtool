<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QDE ESPFlashTool</title>
  <style>
    :root{
      --bg:#0b1220; --card:#0f1a2f; --text:#e8edf7; --muted:#a7b2c7;
      --border:rgba(255,255,255,.10); --shadow:0 12px 35px rgba(0,0,0,.45);
      --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --focus:rgba(96,165,250,.65);
    }
    *{box-sizing:border-box}
    body{
      margin:0; padding:28px 16px; color:var(--text);
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: radial-gradient(1100px 700px at 20% 10%, rgba(96,165,250,.25), transparent 60%),
                  radial-gradient(900px 600px at 90% 25%, rgba(34,197,94,.12), transparent 55%),
                  var(--bg);
    }
    .wrap{max-width:1020px;margin:0 auto}
    .topbar{display:flex;justify-content:space-between;gap:16px;margin-bottom:16px}
    @media (max-width:920px){.topbar{flex-direction:column}}
    h2{margin:0;font-size:22px}
    .subtitle{margin:6px 0 0;color:var(--muted);font-size:13.5px;line-height:1.35}
    .badge{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.06);font-size:12.5px;white-space:nowrap}
    .dot{width:10px;height:10px;border-radius:50%;background:var(--bad);box-shadow:0 0 0 4px rgba(239,68,68,.15)}
    .dot.ok{background:var(--ok);box-shadow:0 0 0 4px rgba(34,197,94,.15)}
    .dot.warn{background:var(--warn);box-shadow:0 0 0 4px rgba(245,158,11,.18)}
    .card{border:1px solid var(--border);border-radius:14px;box-shadow:var(--shadow);overflow:hidden;background:rgba(255,255,255,.04)}
    .grid{display:grid;grid-template-columns:1.05fr 1fr}
    @media (max-width:920px){.grid{grid-template-columns:1fr}}
    .panel{padding:18px;background:rgba(15,26,47,.62)}
    .panel.right{background:rgba(12,22,41,.62);border-left:1px solid var(--border)}
    @media (max-width:920px){.panel.right{border-left:none;border-top:1px solid var(--border)}}
    .section-title{margin:0 0 10px;font-size:13px;letter-spacing:.08em;text-transform:uppercase;color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center;margin:10px 0}
    .row.stack{flex-direction:column;align-items:stretch;gap:8px}
    label{font-size:13.5px;color:var(--muted)}
    input[type="file"],select{
      width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);
      background:rgba(0,0,0,.20);color:var(--text);outline:none
    }
    input[type="file"]::file-selector-button{
      margin-right:10px;padding:8px 10px;border:1px solid var(--border);border-radius:10px;
      background:rgba(255,255,255,.06);color:var(--text);cursor:pointer
    }
    .check{display:flex;align-items:center;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:rgba(0,0,0,.15)}
    button{
      border:1px solid var(--border);background:rgba(255,255,255,.08);color:var(--text);
      padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600
    }
    button:disabled{opacity:.45;cursor:not-allowed}
    .btn-primary{background:rgba(96,165,250,.25);border-color:rgba(96,165,250,.55)}
    .hint{font-size:12.5px;color:var(--muted);line-height:1.35;margin-top:10px;padding:10px 12px;border-radius:10px;border:1px solid var(--border);background:rgba(0,0,0,.15)}
    .progress-wrap{display:flex;align-items:center;gap:10px;margin:10px 0 12px}
    .progress{flex:1;height:10px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid var(--border);overflow:hidden}
    .bar{width:0%;height:100%;background:linear-gradient(90deg, rgba(96,165,250,.95), rgba(34,197,94,.85));transition:width .15s ease}
    .pct{width:54px;text-align:right;color:var(--muted);font-variant-numeric:tabular-nums;font-size:12.5px}
    pre{margin:0;height:360px;overflow:auto;padding:12px;border-radius:10px;border:1px solid var(--border);background:rgba(0,0,0,.25);font-size:12.5px;line-height:1.35;white-space:pre-wrap}
    button:focus,input:focus,select:focus{box-shadow:0 0 0 4px var(--focus);border-color:rgba(96,165,250,.6)}
    .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 8px 12px;
        text-align: center;
        font-size: 12px;
        color: var(--muted);
        background: rgba(11,18,32,0.85);
        border-top: 1px solid var(--border);
        backdrop-filter: blur(6px);
      }

    .footer a {
      color: var(--accent);
      text-decoration: none;
    }

    .footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<footer class="footer">
  <span>
    © <span id="year"></span> Quantum Design and Engineering (PTY) Ltd —
    <a href="https://www.qde.co.za" target="_blank" rel="noopener">www.qde.co.za</a>
    · <span id="appVersion"></span>
  </span>
</footer>

<script>
  import { APP_VERSION } from "/main.js";
  document.getElementById("year").textContent = new Date().getFullYear();
  document.getElementById("appVersion").textContent = `v${APP_VERSION}`;
</script>

<body>
  <div class="wrap">
    <div class="topbar">
      <div>
        <h2>QDE FlashTool (For BlueTech Devices)</h2>
        <p class="subtitle">Chrome/Edge only. Click Connect (you will be prompted to select a COM port), then choose a merged ESP-IDF BIN.</p>
      </div>
      <div class="badge">
        <span id="statusDot" class="dot"></span>
        <span id="status">Not connected</span>
      </div>
    </div>

    <div class="card">
      <div class="grid">
        <div class="panel">
          <div class="section-title">Device & Flashing</div>

          <div class="row">
            <button id="btnConnect" class="btn-primary">Connect</button>
            <button id="btnDisconnect" disabled>Disconnect</button>
            <button id="btnReset" disabled>Reset</button>
            <button id="btnFlash" disabled>Flash</button>
          </div>

          <div class="row stack">
            <label for="binFile">Firmware (.bin)</label>
            <input id="binFile" type="file" accept=".bin,application/octet-stream" />
          </div>

          <div class="row">
            <div class="check" style="flex:1;">
              <input id="chkErase" type="checkbox" />
              <label for="chkErase" style="color: var(--text); margin:0;">Erase before flashing</label>
            </div>
          </div>

          <div class="row stack">
            <label for="baud">Baudrate</label>
            <select id="baud">
              <option value="115200">115200</option>
              <option value="230400">230400</option>
              <option value="460800">460800</option>
              <option value="921600" selected>921600</option>
            </select>
          </div>

          <div class="hint">If connect/flash fails, put the board into bootloader mode (hold in BOOT button while pressing/releasing RESET), then Connect again.</div>
        </div>

        <div class="panel right">
          <div class="section-title">Progress & Log</div>

          <div class="progress-wrap">
            <div class="progress"><div id="progressBar" class="bar"></div></div>
            <div id="progressPct" class="pct">0%</div>
          </div>

          <pre id="log"></pre>
        </div>
      </div>
    </div>

    <!-- Vite will serve / build this module -->
    <script type="module" src="/main.js"></script>
  </div>
</body>
</html>
